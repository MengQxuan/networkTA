# 网络技术与应用课程实验报告
---
## 实验8：PPPoE服务器的配置和应用

> **姓名：孟启轩
学号：2212452
专业：计算机科学与技术**


## 一、实验内容说明

### PPPoE服务器配置和应用实验

（1）仿真有线局域网接入互联网的场景，正确配置PPPoE服务器的认证协议、地址池、虚拟模板和物理接口，使内网用户经认证后才能正常访问外部互联网。

（2）仿真家庭网络中，无线和有线终端（主机、智能电话等）连入小型路由器，由小型路由器统一接入互联网服务运营商PPPoE服务器的场景。对小型路由器和PPPoE服务器进行设置，使家庭网络中的用户经认证后才能正常访问外部互联网。


## 二、前期准备

### 理论知识
PPPoE（Point-to-Point Protocol over Ethernet，以太网上的点对点协议）是一种网络协议，它将点对点协议（PPP）封装在以太网（Ethernet）帧中，用于在多用户以太网环境中建立虚拟的直接连接。PPPoE广泛应用于互联网服务提供商（ISP）为用户提供宽带接入服务，特别是通过DSL（数字用户线路）技术提供的服务。

以下是关于PPPoE的一些关键理论知识：

#### 1. PPPoE的工作原理
PPPoE分为两个阶段：发现阶段和会话阶段。

- **发现阶段**：客户端发起发现过程，试图找到一个可用的PPPoE服务器。这一阶段包括四个步骤：发起（PADI）、提供（PADO）、请求（PADR）和会话确认（PADS）。通过这些步骤，客户端和服务器之间建立了唯一的会话ID。
  
- **会话阶段**：一旦建立了会话，客户端就可以使用PPP来发送数据包。这个阶段涉及常规的PPP通信，如身份验证、IP地址分配等，并且所有通信都带有前面确定的会话ID。

#### 2. PPPoE的优点
- **安全性**：由于PPP支持多种认证协议，如PAP（Password Authentication Protocol）和CHAP（Challenge Handshake Authentication Protocol），因此可以提高连接的安全性。
- **灵活性**：PPPoE可以在任何支持以太网的网络上运行，使得它非常灵活。
- **QoS支持**：一些实现允许根据不同的服务级别协议（SLA）来区分流量优先级。

#### 3. PPPoE的局限性
- **性能开销**：相比直接的以太网连接，PPPoE增加了额外的头部信息，这可能带来一定的性能损失。
- **复杂性增加**：对于网络管理员来说，配置和维护PPPoE可能会比简单的以太网连接更复杂。

#### 4. PPPoE的应用场景
PPPoE主要用于住宅宽带连接，尤其是通过DSL提供的服务。当用户想要访问互联网时，他们的计算机或路由器通过PPPoE与ISP的接入服务器建立连接。此外，PPPoE也适用于需要基于每个用户进行独立计费或管理的多租户环境，如酒店或公寓楼。

### 拓扑图

> 拓扑图如下：

![](拓扑.png)

![](拓扑2.png)

### `IP`地址分配

> 本次实验的`IP`地址分配如下所示：

| Machine | IPv4 Address | Subnet Mask | 网关 |
| :----: | :----: | :----: | :----: |
| PC0 | 由路由器分配 | 255.255.255.0 |  |
| PC1 | 由路由器分配 | 255.255.255.0 |  |
| PC2 | 192.168.3.2 | 255.255.255.0 | 192.168.3.1 |
| Server0 | 192.168.2.3 | 255.255.255.0 |  |
| Server1 | 192.168.3.3 | 255.255.255.0 | 192.168.3.1 |
| Router0 Fa0/0 | 192.168.1.1 | 255.255.255.0 |  |
| Router0 Fa0/1 | 192.168.2.1 | 255.255.255.0 |  |
| Router1 Fa0/0 | 192.168.2.2 | 255.255.255.0 |  |
| Router1 Fa0/1 | 192.168.3.1 | 255.255.255.0 |  |
## 三、实验过程



**(1)基本配置**

首先对三台主机以及服务器按照准备过程中的地址进行ip地址配置，由于ip地址的配置并不是本次实验的重点，这里只展示出两个路由器配置完成后的地址分配：
![](r1.png)
![](r2.png)
按照拓扑图配置仿真环境下的网络，保证所连接的设备能够ping通。


**(2)配置认证协议和用户**

为了验证接入用户的合法性，我们需要在接入服务器上启动并配置认证服务。在本次实验中，`aaa`命令用于在全局模式下进行认证、授权和计费服务的配置。以下是启动认证服务并选择认证方式的相关命令（同时将主机的IP地址和端口号进行绑定）：
```c++
Router(config)#aaa new-model
Router(config)#aaa authentication ppp myPPPoE group radius
Router(config)#radius-server host 192.168.2.3 auth-port 1645 key radius123
```

配置完成后的界面如下图所示：

![](配置2.png)

**(3)AAA服务器配置**

1. 首先，需要在服务器的AAA服务中添加提供服务路由器的相关信息，包括路由器的名称、IP地址和端口号等。
2. 其次，在服务器中设置相应的用户及其口令，以便用户能够顺利连接并被投递到外部网络，从而实现对其的服务。
3. 完成以上配置后，服务器的AAA服务界面将显示如下信息：

![](服务器.png)



**(4)地址池配置**

用户在接入时，PPPoE服务器需要为其分配IP地址。为此，在配置PPPoE时，需建立一个地址池，用于指定分配给登录用户的IP地址范围。可以通过在全局配置模式下使用`ip local pool PoolName StartIP EndIP`命令来创建本地地址池。

1. `PoolName`是一个用户选择的字符串，用于标识该IP地址池。
2. `StartIP`和`EndIP`分别代表该地址池的起始IP地址和结束IP地址。

在本次实验中使用如下命令来为其分配地址池：

`ip local pool myPool 192.168.1.100 192.168.1.200`

![](地址池.png)

**(5)虚拟模板配置**

网络中通常具有**接口**，这些接口用于连接网络或其他设备，并且可以进行相应的配置。在使用PPPoE服务时，服务器会为每个请求接入的用户创建一个逻辑接口，使得用户感觉他们连接到了一个实际存在的接口。以下是相关的配置命令：

```c++
Router(config)#interface virtual-template 1
Router(config-if)#ip unnumbered fa0/0
Router(config-if)#peer default ip address pool myPool
Router(config-if)#ppp authentication chap myPPPoE
Router(config-if)#exit
```

1. 创建编号为1的虚拟模板，并进入该模板的配置模式：
   - 在这一步，建立了一个虚拟模板，并通过进入其配置模式，可以对该模板进行进一步的设置和配置。

2. 不为利用该模板创建的逻辑接口分配`IP`地址：
   - 这表示在虚拟模板中，不指定逻辑接口的`IP`地址。如果该接口需要发送`IP`数据报，将使用`fa0/0`接口的`IP`地址作为数据报的源IP地址。

3. 服务器为请求的用户分配`IP`地址时采用地址池的`IP`地址：
   - 这表示在服务器为`PPPoE`请求的用户分配`IP`地址时，会使用一个特定的地址池中的`IP`地址。这样可以有效地管理和分配`IP`地址。

4. 该模板将使用`CHAP`协议进行认证，并采用`myPPPoE`中规定的认证方式：
   - 在这一步，设置虚拟模板使用`CHAP`协议进行认证。同时，认证方式将遵循在名为`myPPPoE`中定义的具体规则。这确保了在虚拟模板中采用一致的认证机制，提高了系统的安全性和一致性。


配置完成后如下图所示：

![](ppp.png)


**(6)创建BBA组**

在配置PPPoE服务器时，需要建立相关的PPPoE协议组，相应的命令如下：

```c++
Router(config)#bba-group pppoe myBBAGroup
Router(config-bba)#virtual-template 1
Router(config-bba)#exit
```


在Cisco路由器上，存在一个重要的限制：每个路由器只能同时运行一个`PPPoE BBA(Broadband Access)`组。例如，如果已经创建了一个名为"myGroup"的PPPoE组，路由器将不允许再创建另一个运行PPPoE协议的BBA组。

这意味着在任何给定时刻，路由器只能维护一个PPPoE组的活动状态。如果你尝试创建另一个PPPoE组，系统将拒绝该操作并提示已经存在一个运行中的组。

这一限制旨在确保对PPPoE BBA组的有效管理，并防止可能的配置冲突和混淆。如果需要创建新的PPPoE BBA组，必须首先停止或删除现有的组，然后才能创建新的组。


配置完成后如下图所示：

![](bba.png)



**(7)配置物理接口**


PPPoE协议最终需要运行在一个物理接口上，因此需要在发送、接收PPPoE报文的接口上启动PPPoE功能，具体命令如下：

```c++
Router(config)#interface fa0/0
Router(config-if)#pppoe enable group myBBAGroup
Router(config-if)#exit
```

1. 第一条命令表示进入接口配置模式
2. 第二条命令代表允许在该接口上启动PPPoE协议
3. 由于在Cisco路由器中只有一个采用PPPoE协议的BBA组，所以不需要指定组名


配置完物理接口如下图所示：

![](ebba.png)



**(8)验证配置的PPPoE接入服务器**


配置完上述设置后，PPPoE接入服务器已经准备好接受来自客户端的请求。当服务器接收到请求时，将对用户进行身份认证，并为通过验证的用户建立相应的逻辑接口。

一旦逻辑接口创建完成，PPPoE接入服务器就能够在这个接口上收发和处理PPPoE用户的数据报文。接下来，我们需要提供在PPPoE接入服务器上设置的用户名和密码（例如，bob和bob123）。一旦连接成功，界面将显示如下状态：

![](连接成功.png)

然后就可以取用主机访问外部的主机，比如`ping`命令如下图所示：

![](平.png)


最后用`PC0`访问`server1`的`web`服务：

![](页面1.png)


**(9)添加无线设备**

在原有的拓扑结构上添加一个无线路由器，并对无线路由器进行配置：
![](无线配置.png)

使用智能电话`ping`外网主机：

![](平2.png)

## 四、遇到的问题

本次实验最主要遇到的问题就是`Cisco Packet Tracer 7.0`软件的版本较低，导致在配置`Router(config)#bba-group pppoe myBBAGroup`这个命令时，提示`Invalid input detected at '^' marker`的错误。找了很多方法尝试解决都没有成功，最后更换为`Cisco Packet Tracer 7.2`解决了这个问题。

## 五、实验感悟

通过深入研究PPPoE服务器的认证协议、地址池管理、虚拟模板配置及物理接口设置，并在仿真环境中实践，我对PPPoE的工作机制有了更深层次的理解，包括其在提供用户身份验证、加密通信以及通过唯一Session ID确保安全性方面的作用。PPPoE作为PPP协议的一种实现形式，不仅弥补了传统以太网在安全性和功能上的不足，而且广泛应用于终端设备连接ISP进行宽带接入，支持多种以太网线路类型，如缆线调制解调器和DSL，同时实现了用户管理和网络计费等功能。此次实验模拟了有线局域网与家庭网络接入互联网的过程，加深了我对PPPoE配置细节和技术应用的认识，提升了实际操作技能和对网络架构规划重要性的理解，为未来设计复杂且高效的网络系统奠定了基础。
